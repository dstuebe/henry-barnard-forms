<html>
    <head>
        <title>Apply to HBS</title>
        <script src="https://js.stripe.com/v3/"></script>
        <script src="https://code.jquery.com/jquery-latest.min.js"></script>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
            integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

        <style>
            .required label::after {
                content: "*";
                color: red;
                margin-left: 5px
            }

            #card-errors {
                background-color: red;
                color: white;
                font-weight: bold;
            }
        </style>
    </head>

    <body>
        <div class="container pb-4" style="padding-top: 14px; border: 1px solid #ced4da; border-radius: 5px;">
            <h2>Henry Barnard School Student Application</h2>
            <hr>
            <div class="mb-4 mt-4">
                Please complete this form for <em>each child</em> seeking admission. Note that children seeking admission to Preschool must be toilet-trained before the start of the school year.
            </div>
            <div>
                Once the application has been completed, you can submit along with <strong>payment of the $50 application fee</strong> directly below, or mail a check to
                <strong>Henry Barnard School, P.O. Box 28153, Providence, RI 02908</strong> and include the <a href="https://www.henrybarnard.org/check-payment-form" target="_blank" >Check Payment Form</a>.
            </div>

            <hr class="mb-5">

            <form id="application-form" action="">
                <div class="row pl-2">
                    <div class="form-group required ml-2">
                        <label for="name">Grade applying for</label>
                        <select id="grade" class="form-control" required>
                            <option value=""></option>
                            <option value="Pre-K">Pre-K</option>
                            <option value="Pre-K (Part Time)">Pre-K (Part Time)</option>
                            <option value="Kindergarten">Kindergarten</option>
                            <option value="1st grade">1st Grade</option>
                            <option value="2nd grade">2nd Grade</option>Grade</option>
                            <option value="3rd grade">3rd Grade</option>
                            <option value="4th grade">4th Grade</option>
                            <option value="5th grade">5th Grade</option>
                        </select>
                    </div>
                </div>

                <div class="row pl-2">
                    <div class="form-group required ml-2">
                        <label for="childs-first-name">Child's first name</label>
                        <input id="childs-first-name" class="form-control" type="text"  required/>
                    </div>

                    <div class="form-group required ml-2">
                        <label for="childs-last-name">Child's last name</label>
                        <input id="childs-last-name" class="form-control" type="text"  required/>
                    </div>

                    <div class="form-group ml-2">
                        <label for="childs-preferred-name">Child's preferred name (If different)</label>
                        <input id="childs-preferred-name" class="form-control" type="text"/>
                    </div>
                </div>

                <div class="row pl-2">
                    <div class="form-group required ml-2">
                        <label for="child-identifies-as">My child identifies as</label>
                        <select id="child-identifies-as" class="form-control" required>
                            <option value=""></option>
                            <option value="Boy">Boy</option>
                            <option value="Girl">Girl</option>
                            <option value="Non-Binary">Non-Binary</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>

                <div class="row pl-2">
                    <div class="form-group ml-2">
                        <label for="childs-preferred-pronouns">My child's preferred pronouns</label>
                        <input id="childs-preferred-pronouns" class="form-control" type="" />
                    </div>
                </div>

                <hr class="mt-3 mb-3">

                <div class="row pl-2">
                    <div class="form-group required ml-2">
                        <label for="dob">Child's date of birth</label>
                        <input id="dob" class="form-control" type="date" required/>
                    </div>
                </div>

                <div class="row pl-2">
                    <div class="form-group required ml-2">
                        <label for="address">Address</label>
                        <input id="address" class="form-control" type="text" required/>
                    </div>
                </div>

                <div class="row pl-2">
                    <div class="form-group required ml-2">
                        <label for="city">City</label>
                        <input id="city" class="form-control" type="text" required/>
                    </div>

                    <div class="form-group required ml-2">
                        <label for="state">State</label>
                        <input id="state" class="form-control" type="text" required/>
                    </div>

                    <div class="form-group required ml-2">
                        <label for="zip">Zip code</label>
                        <input id="zip" class="form-control" type="text" required/>
                    </div>
                </div>

                <div class="row pl-2">
                    <div class="form-group required ml-2">
                        <label for="phone">Home phone</label>
                        <input id="phone" class="form-control" type="tel" required/>
                    </div>
                </div>

                <hr class="mt-5 mb-5">
                <h4 class="mb-3">Parent/Guardian Information</h4>

                <div class="row pl-2">
                    <div class="form-group required ml-2">
                        <label for="resides-with">Child resides with</label>
                        <select id="resides-with" class="form-control" required>
                            <option value=""></option>
                            <option value="Both Parents/Guardians">Both Parents/Guardians </option>
                            <option value="Parent/Guardian 1">Parent/Guardian 1</option>
                            <option value="Parent/Guardian 2">Parent/Guardian 2</option>
                        </select>
                    </div>
                </div>

                <div class="mt-3 mb-2">
                    <strong>Parent/Guardian 1</strong>
                </div>

                <div class="row pl-2">
                    <!-- <div class="form-group required ml-2">
                        <label for="parent-guardian-1-salutation">Salutation</label>
                        <select id="parent-guardian-1-salutation" class="form-control" required>
                            <option value=""></option>
                            <option value="Mr.">Mr.</option>
                            <option value="Mrs.">Mrs.</option>
                            <option value="Dr.">Dr.</option>
                            <option value="Ms.">Ms.</option>
                        </select>
                    </div> -->

                    <div class="form-group required ml-2">
                        <label for="parent-guardian-1-first-name">First Name</label>
                        <input id="parent-guardian-1-first-name" class="form-control" type="text" required/>
                    </div>

                    <div class="form-group required ml-2">
                        <label for="parent-guardian-1-last-name">Last Name</label>
                        <input id="parent-guardian-1-last-name" class="form-control" type="text" required/>
                    </div>
                </div>

                <div class="row pl-2">
                    <div class="form-group required ml-2">
                        <label for="parent-guardian-1-email">Email address</label>
                        <input id="parent-guardian-1-email" class="form-control" type="email" required/>
                    </div>
                </div>

                <div class="row pl-2">
                    <div class="form-group required ml-2">
                        <label for="parent-guardian-1-address">Address</label>
                        <input id="parent-guardian-1-address" class="form-control" type="text" required/>
                    </div>
                </div>

                <div class="row pl-2">
                    <div class="form-group required ml-2">
                        <label for="parent-guardian-1-city">City</label>
                        <input id="parent-guardian-1-city" class="form-control" type="text" required/>
                    </div>

                    <div class="form-group required ml-2">
                        <label for="parent-guardian-1-state">State</label>
                        <input id="parent-guardian-1-state" class="form-control" type="text" required/>
                    </div>

                    <div class="form-group required ml-2">
                        <label for="parent-guardian-1-zip">Zip code</label>
                        <input id="parent-guardian-1-zip" class="form-control" type="text" required/>
                    </div>
                </div>

                <div class="row pl-2">
                    <div class="form-group required ml-2">
                        <label for="parent-guardian-1-phone">Phone</label>
                        <input id="parent-guardian-1-phone" class="form-control" type="tel" required/>
                    </div>
                </div>

                <span class="parent-guardian-2">
                    <div class="mt-3 mb-2">
                        <strong>Parent/Guardian 2</strong>
                    </div>

                    <div class="row pl-2">
                        <!-- <div class="form-group ml-2">
                            <label for="parent-guardian-2-salutation">Salutation</label>
                            <select id="parent-guardian-2-salutation" class="form-control">
                                <option value=""></option>
                                <option value="Mr.">Mr.</option>
                                <option value="Mrs.">Mrs.</option>
                                <option value="Dr.">Dr.</option>
                                <option value="Ms.">Ms.</option>
                            </select>
                        </div> -->

                        <div class="form-group ml-2">
                            <label for="parent-guardian-2-first-name">First Name</label>
                            <input id="parent-guardian-2-first-name" class="form-control" type="text"/>
                        </div>

                        <div class="form-group ml-2">
                            <label for="parent-guardian-2-last-name">Last Name</label>
                            <input id="parent-guardian-2-last-name" class="form-control" type="text"/>
                        </div>
                    </div>

                    <div class="row pl-2">
                        <div class="form-group ml-2">
                            <label for="parent-guardian-2-email">Email address</label>
                            <input id="parent-guardian-2-email" class="form-control" type="email"/>
                        </div>
                    </div>

                    <div class="row pl-2">
                        <div class="form-group ml-2">
                            <label for="parent-guardian-2-address">Address</label>
                            <input id="parent-guardian-2-address" class="form-control" type="text"/>
                        </div>
                    </div>

                    <div class="row pl-2">
                        <div class="form-group ml-2">
                            <label for="parent-guardian-2-city">City</label>
                            <input id="parent-guardian-2-city" class="form-control" type="text"/>
                        </div>

                        <div class="form-group ml-2">
                            <label for="parent-guardian-2-state">State</label>
                            <input id="parent-guardian-2-state" class="form-control" type="text"/>
                        </div>

                        <div class="form-group ml-2">
                            <label for="parent-guardian-2-zip">Zip code</label>
                            <input id="parent-guardian-2-zip" class="form-control" type="text"/>
                        </div>
                    </div>

                    <div class="row pl-2">
                        <div class="form-group ml-2">
                            <label for="parent-guardian-2-phone">Phone</label>
                            <input id="parent-guardian-2-phone" class="form-control" type="tel"/>
                        </div>
                    </div>
                </span>

                <hr class="mt-5 mb-5">

                <h4 class="mt-5">Siblings </h4>
                PLEASE LIST ANY SIBLINGS and the School at which they are currently enrolled
                <div class="mt-3">
                    <strong>Sibling 1</strong>
                </div>
                <div class="row pl-2">
                    <div class="form-group ml-2">
                        <label for="sibling-1-name">Name</label>
                        <input id="sibling-1-name" class="form-control" type="text"/>
                    </div>
                    <div class="form-group ml-2">
                        <label for="sibling-1-school">School</label>
                        <input id="sibling-1-school" class="form-control" type="text"/>
                    </div>
                    <div class="form-group ml-2">
                        <label for="sibling-1-grade">Grade</label>
                        <input id="sibling-1-grade" class="form-control" type="text"/>
                    </div>
                </div>

                <div class="mt-3">
                    <strong>Sibling 2</strong>
                </div>
                <div class="row pl-2">
                    <div class="form-group ml-2">
                        <label for="sibling-2-name">Name</label>
                        <input id="sibling-2-name" class="form-control" type="text"/>
                    </div>
                    <div class="form-group ml-2">
                        <label for="sibling-2-school">School</label>
                        <input id="sibling-2-school" class="form-control" type="text"/>
                    </div>
                    <div class="form-group ml-2">
                        <label for="sibling-2-grade">Grade</label>
                        <input id="sibling-2-grade" class="form-control" type="text"/>
                    </div>
                </div>

                <div class="mt-3">
                    <strong>Sibling 3</strong>
                </div>
                <div class="row pl-2">
                    <div class="form-group ml-2">
                        <label for="sibling-3-name">Name</label>
                        <input id="sibling-3-name" class="form-control" type="text"/>
                    </div>
                    <div class="form-group ml-2">
                        <label for="sibling-3-school">School</label>
                        <input id="sibling-3-school" class="form-control" type="text"/>
                    </div>
                    <div class="form-group ml-2">
                        <label for="sibling-3-grade">Grade</label>
                        <input id="sibling-3-grade" class="form-control" type="text"/>
                    </div>
                </div>

                <div class="mt-3">
                    <strong>Sibling 4</strong>
                </div>
                <div class="row pl-2">
                    <div class="form-group ml-2">
                        <label for="sibling-4-name">Name</label>
                        <input id="sibling-4-name" class="form-control" type="text"/>
                    </div>
                    <div class="form-group ml-2">
                        <label for="sibling-4-school">School</label>
                        <input id="sibling-4-school" class="form-control" type="text"/>
                    </div>
                    <div class="form-group ml-2">
                        <label for="sibling-4-grade">Grade</label>
                        <input id="sibling-4-grade" class="form-control" type="text"/>
                    </div>
                </div>

                <hr class="mt-3 mb-5">
                <h4 class="mt-5">Additional Questions </h4>
                <div class="row pl-2 pr-2">
                    <div class="form-group required ml-2">
                        <label for="ideal-environment">What would be the ideal school environment for your child and your family?</label>
                        <textarea id="ideal-environment" class="form-control" required rows="4" cols="70"></textarea>
                    </div>
                </div>

                <div class="row pl-2 pr-2">
                    <div class="form-group required ml-2">
                        <label for="curious-child">Complete this sentence: “When my child is curious about something...”</label>
                        <textarea id="curious-child" class="form-control" required rows="4" cols="70"></textarea>
                    </div>
                </div>

                <div class="row pl-2 pr-2">
                    <div class="form-group required ml-2">
                        <label for="collaborate">How would your family like to collaborate with the Henry Barnard School community?</label>
                        <textarea id="collaborate" class="form-control" required rows="4" cols="70"></textarea>
                    </div>
                </div>

                <div class="row pl-2 pr-2">
                    <div class="form-group  ml-2">
                        <label for="most-recent-schooling">If your child has not previously attended HBS, please tell us about their <br/>most recent schooling/childcare experience.</label>
                        <textarea id="most-recent-schooling" class="form-control" rows="4" cols="70"></textarea>
                    </div>
                </div>

                <hr class="mt-4 mb-4">

                <div class="row pl-2 pr-2">
                    <div class="form-group ml-2">
                        <h4 for="how-did-you-hear-about-us">How did you hear about us?</h4>
                        <fieldset>
                            <div class="form-check">
                                <input type="checkbox" id="hear-website" class="form-check-input"/>
                                <label class="form-check-label">Website</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" id="hear-friend-parent" class="form-check-input"/>
                                <label class="form-check-label">Friend/Parent</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" id="hear-advertisement" class="form-check-input"/>
                                <label for="hear-advertisement" class="form-check-label">Advertisement</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" id="hear-other" class="form-check-input"/>
                                <label for="hear-other" class="form-check-label">Other</label>
                                <input type="text" class="form-control" placeholder="Details" id="hear-other-detail">
                            </div>
                        </fieldset>
                    </div>
                </div>

                <hr class="mt-4 mb-4">

                <strong>OPTIONAL:</strong> For Federal and State reporting purposes, we are asked to obtain the following information concerning the ethnicity of all applicants. This information is not used in the determination of admission to Henry Barnard School.
                <div class="row pl-2 pr-2 mt-4">
                    <div class="form-group ml-2">
                        <select id="ethnicity" class="form-control">
                            <option value=""></option>
                            <option value="American Indian or Alaska Native">American Indian or Alaska Native</option>
                            <option value="Asian">Asian</option>
                            <option value="Black or African American">Black or African American</option>
                            <option value="Hispanic">Hispanic</option>
                            <option value="Native Hawaiian or Other Pacific Islander">Native Hawaiian or Other Pacific Islander</option>
                            <option value="White">White</option>
                            <option value="Two or More Races">Two or More Races</option>
                        </select>
                    </div>
                </div>

                <hr class="mt-4 mb-4">

                <div class="row pl-2 pr-2" id="payment-type-group">
                    <div class="form-group ml-2">
                        <h4>Application Fee - $50</h4>
                        <div>
                            <label for="payment-type" class="form-check-label">How would you like to pay the application fee?</label> <div><em>Fee is waived for existing families</em></div>
                            <select class="form-control" id="payment-type" required>
                                <option value=""></option>
                                <option value="Credit Card">Credit Card</option>
                                <option value="Check">Check</option>
                                <option value="Existing Family">Existing Family (fee waived)</option>
                            </select>
                        </div>

                    </div>
                </div>

                <div class="mt-3 d-none" id="credit-card-payment">
                    <div class="row pl-2 pr-2">
                        <div class="form-group required ml-2">
                            <label for="cc-name">Name</label>
                            <input id="cc-name" class="form-control" type="text" />
                        </div>

                        <div class="form-group required ml-2">
                            <label for="cc-email">Email</label>
                            <input id="cc-email" class="form-control" type="email" placeholder="name@example.com" />
                        </div>
                    </div>

                    <label for="card-element">Credit Card</label>
                    <div id="card-element" style="padding: 10px; border: 1px solid #ced4da; border-radius: 5px; margin-bottom: 30px;">
                    </div>


                    <div id="card-errors" role="alert" class="mb-3 pl-2 pt-2 pb-2 pr-2 d-none"></div>
                </div>

                <div class="mt-3 mb-3 ml-2">
                    <em>Henry Barnard School is committed to equal opportunity in admissions and employment. No student, employee, or applicant will be denied admission, employment, or access to program activities because of race, sex, gender, gender identity, religion, age, color, national origin, handicap, sexual orientation, conviction record, or Vietnam-era status.</em>
                </div>

                <div class="form-check pt-3 pb-3">
                    <input id="_optin" type="checkbox" checked />
                    <label for="_optin">Please keep me informed about the new Henry Barnard School!</label>
                </div>

                <button class="btn btn-success mt-3 ml-2" id="submit">Apply</button>
            </form>

            <div id="thank-you" class="d-none mt-5 mb-5">
                <h4>Thank you. Your application has been received. </h4>
                <br/>- If paying by check your application will not be reviewed until payment is received.
                <br/> - A representative from Henry Barnard School will be in contact with you soon.

                <div class="row pl-2 pr-2 mt-3" id="check-payment">
                    <a href="https://www.henrybarnard.org/check-payment-form" target="_blank" type="button" class="btn btn-info">Download Check Payment Form</a>
                </div>
            </div>
        </div>
    </body>

    <script>

        const formSpreeCheckId = "xzbkjjyv";
        const formSpreeExistingFamilyId = "mleoogap";

        // Test Keys for Card Payments
        //const formSpreeCreditId = "mleopzjn";
        //const stripeKey = "pk_test_51Hy74yDnj8WOjoQRyboXSG4gKsFMYFG3EG4H3Hn2Qp3XE11bXlLWLeoYZBrenaZDr8FMzjLwfqeDr0C9uSs3WVtL006yqiN34K";


        // Production Keys for Car Payments (Live payments)
        const formSpreeCreditId = "mzbkjoea";
        const stripeKey = "pk_live_51Hy74yDnj8WOjoQRVldAbCMGfOE52XnnG77kBxW7exeZqiUhpMB6vDZTtwjRIpVaCYBMlNpxMM5WhvSqtNr9aW7z00DZYqasZc";


        // pull down the form data and add to the object passed in
        function getFormData(formData) {
            formData["submitted_date"] = new Date().toDateString();

            Array.from(document.forms[0]).reduce(
                (acc, currentVal) => {
                    if (currentVal.id && currentVal.id !== "submit") {
                        if (currentVal.type == "checkbox") {
                            acc[currentVal.id] = currentVal.checked;
                        } else {
                            acc[currentVal.id] = currentVal.value || "";
                        }
                    }
                    return acc;
                },
                formData
            );

            return formData;
        }

        $(document).ready(function () {
            // Stripe settings
            var stripe = Stripe(stripeKey);
            var elements = stripe.elements();
            var style = {
                base: {
                    color: "#32325d",
                },
            };
            var card = elements.create("card", {
                style: style,
            });

            card.mount("#card-element");
            card.on("change", ({ error }) => {
                const displayError = document.getElementById("card-errors");
                if (error) {
                    displayError.textContent = error.message;
                    $("#card-errors").removeClass("d-none");
                } else {
                    displayError.textContent = "";
                    $("#card-errors").addClass("d-none");
                }
            });


            let form = document.getElementById("application-form");
            form.addEventListener("submit",  event => {
                $("#submit").html("Submitting").prop("disabled", "true");
                event.preventDefault();

                let paymentType = $("#payment-type").val();

                if (paymentType === "Credit Card") {
                    stripe
                        .createPaymentMethod({
                            type: "card",
                            card: card,
                            billing_details: {
                                // Include any additional collected billing details.
                                name: $("#cc-name").val(),
                                email: $("#cc-email").val(),
                            },
                        })
                        .then(stripePaymentMethodHandler)
                        .finally(() => $("#submit").html("Apply").removeProp("disabled"));
                }

                if (paymentType === "Check" || paymentType === "Existing Family") {
                    let formData = getFormData({ _replyto: $("#parent-guardian-1-email").val() });
                    let formSpreeId = formSpreeCheckId;
                    if (paymentType === "Existing Family") {
                        formSpreeId = formSpreeExistingFamilyId;
                    }
                    fetch("https://formspree.io/f/" + formSpreeId, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(formData)
                    }).then(function (result) {
                        // Handle server response
                        result.json().then(function (json) {
                            handleServerResponse(json);
                        });
                    });
                }
            });



            // handle result from tokenization of card payment and submitt to formspree to make payment
            function stripePaymentMethodHandler(result) {
                if (result.error) {
                    // Show error to user
                    $("#card-errors").html(result.error.messge).removeClass("d-none");
                    $("#submit").html("Apply").removeProp("disabled");
                } else {
                    let formData = getFormData({
                        // Send the tokenized card
                        _payment_method: result.paymentMethod.id,
                        email: $("#cc-email").val()
                    });
                    console.log("formData", formData);
                    // Otherwise send payment method to your server
                    fetch("https://formspree.io/f/" +formSpreeCreditId, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(formData)
                    }).then(function (result) {
                        // Handle server response
                        console.log("result", result);
                        result.json().then(function (json) {
                            handleServerResponse(json);
                        });
                    }).catch(function(error) {
                        console.log(error)
                    });

                }
            }

            function handleServerResponse(response) {
                console.log(response);
                $("#submit").html("Apply").removeProp("disabled");
                if (response.ok) {
                    // Display errors on the payment form
                    $("#submit").addClass("d-none");
                    $("#thank-you").removeClass("d-none");
                } else {
                    $("#card-errors").text(JSON.stringify(response)).removeClass("d-none");
                }
            }

            document.getElementById('payment-type').addEventListener("change", event => {
                let ccClasses = document.getElementById("credit-card-payment").classList;
                if (event.target.value === "Credit Card") {
                    ccClasses.remove("d-none")
                    $("cc-name").attr("required", true);
                    $("cc-email").attr("required", true);
                } else {
                    ccClasses.add("d-none");
                    $("cc-name").removeAttr("required");
                    $("cc-email").removeAttr("required");
                }

                let checkClasses = document.getElementById("check-payment").classList;
                if (event.target.value === "Check") {
                    checkClasses.remove("d-none")
                } else {
                    checkClasses.add("d-none");
                }
            });
        });
    </script>
</html>